# 弃用接口迁移清单（2026H1）

- 适用版本：SiYuan `v3.5.7`
- 官方仓库同步到：`siyuan-note/siyuan@master` + Release `v3.5.7`（2026-02-14）
- 最后核对：2026-02-21
- 稳定性：deprecated
- 权威来源：
  - <https://github.com/siyuan-note/siyuan/blob/master/kernel/api/router.go>
  - <https://github.com/siyuan-note/siyuan/issues/15308#issuecomment-3077696005>
  - <https://github.com/siyuan-note/siyuan/issues/16664#issuecomment-3694774305>
  - <https://github.com/siyuan-note/siyuan/issues/15310#issuecomment-3239696237>

## 1. 迁移总览

|旧接口/旧参数|新接口/新参数|状态|目标日期|证据|
|---|---|---|---|---|
|`/api/system/reloadUI`|`/api/ui/reloadUI`|计划移除旧接口|2026-06-30 后|<https://github.com/siyuan-note/siyuan/issues/15308#issuecomment-3077675356>|
|`/api/storage/setLocalStorage`|`/api/storage/setLocalStorageVal`|计划移除旧接口|2026-06-30 后|<https://github.com/siyuan-note/siyuan/issues/16664#issuecomment-3694774305>|
|`/api/filetree/refreshFiletree`|`/api/system/rebuildDataIndex`|计划移除旧接口|2026-06-30 后|<https://github.com/siyuan-note/siyuan/issues/15663#issuecomment-3219296189>|
|`/api/av/searchAttributeViewNonRelationKey`|避免使用（无稳定替代承诺）|计划删除|2026-06-30 后|<https://github.com/siyuan-note/siyuan/issues/15727>|
|`batchSetAttributeViewBlockAttrs.values[*].rowID`|`itemID`|参数迁移|2026-06-30 后|<https://github.com/siyuan-note/siyuan/issues/15310#issuecomment-3239696237>|

## 2. 迁移建议

1. 从现在开始优先写新接口，不再新增旧接口调用。
2. 旧插件保留短期兼容分支，至少打印一次迁移告警。
3. 对 AV 相关调用提前支持 `itemID`，避免集中爆改。

## 3. 兼容模板

```ts
async function reloadUI(request: (url: string, data?: any) => Promise<any>) {
  try {
    return await request("/api/ui/reloadUI");
  } catch {
    return await request("/api/system/reloadUI");
  }
}
```

## 4. 注意事项

- `reloadUI` 涉及多端刷新行为，谨慎在高频流程中调用。
- `setLocalStorage*` 类接口迁移时，建议统一封装存储函数。
- AV 参数迁移可能与数据库绑定逻辑耦合，先在测试库验证再上线。

## 5. 本章如何使用

- 每次发布前必看本页
- 遇到“旧版可用、新版报错”时优先比对本表
- 迁移完成后删除 fallback，降低维护成本
- 若需要查看 router 侧更多风险条目，见 `reference/07-official-index/router路由变更与风险索引.md`
