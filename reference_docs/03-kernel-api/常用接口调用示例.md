# 常用接口调用示例

- 适用版本：SiYuan `v3.5.7`
- 官方仓库同步到：`siyuan-note/siyuan@master` + Release `v3.5.7`（2026-02-14）
- 最后核对：2026-02-21
- 稳定性：stable
- 权威来源：
  - <https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md>
  - <https://github.com/siyuan-note/siyuan/blob/master/kernel/api/router.go>

## 1. 请求封装（建议复用）

```ts
import { fetchSyncPost } from "siyuan";

async function requestApi<T = any>(url: string, data?: any): Promise<T> {
  const res = await fetchSyncPost(url, data);
  if (res.code !== 0) throw new Error(res.msg || url);
  return res.data as T;
}
```

说明：`requestApi` 适用于 JSON 请求。`/api/asset/upload` 与 `/api/file/putFile` 需要 `multipart` 提交。

## 2. 文档与块

### 2.1 创建文档（Markdown）

```ts
await requestApi("/api/filetree/createDocWithMd", {
  notebook: "20210808180117-czj9bvb",
  path: "/foo/bar",
  markdown: "# Hello"
});
```

### 2.2 插入块

```ts
await requestApi("/api/block/insertBlock", {
  dataType: "markdown",
  data: "New paragraph",
  parentID: "20210104091228-d0rzbmm"
});
```

### 2.3 获取块 Kramdown

```ts
const data = await requestApi("/api/block/getBlockKramdown", {
  id: "20210104091228-d0rzbmm"
});
```

## 3. 属性与标签

```ts
await requestApi("/api/attr/setBlockAttrs", {
  id: "20210104091228-d0rzbmm",
  attrs: {
    "custom-status": "done"
  }
});
```

## 4. SQL 查询

```ts
const rows = await requestApi("/api/query/sql", {
  stmt: "SELECT id, content FROM blocks WHERE content LIKE '%keyword%' LIMIT 20"
});
```

## 5. 资源与文件

### 5.1 上传资源

接口要求 `multipart/form-data`，字段如下：

- `assetsDirPath`：资源存放路径（如 `/assets/`）
- `file[]`：上传文件列表

实现方式按运行环境选择（`fetch`/`axios`/插件封装），确保以 `multipart` 提交。

### 5.2 写入文件

接口要求 `multipart/form-data`，字段如下：

- `path`：工作空间路径
- `isDir`：是否创建目录
- `modTime`：最近访问/修改时间（Unix time）
- `file`：文件内容

实现方式按运行环境选择（`fetch`/`axios`/插件封装），确保以 `multipart` 提交。

### 5.3 读取文件

```ts
const file = await requestApi("/api/file/getFile", {
  path: "/data/storage/my-plugin/config.json"
});
```

## 6. 通知与系统

```ts
await requestApi("/api/notification/pushMsg", {
  msg: "Sync done"
});

const version = await requestApi("/api/system/version", {});
```

## 7. 本章如何使用

- 先确认接口路径，再对照参数结构。
- 复杂操作拆分为“查询 → 执行 → 校验”三步。
- 对高风险操作统一做错误提示与回滚策略。
