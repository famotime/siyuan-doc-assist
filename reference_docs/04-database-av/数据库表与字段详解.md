# 数据库表与字段详解

- 适用版本：SiYuan `v3.5.7`
- 官方仓库同步到：`siyuan-note/siyuan@master` + Release `v3.5.7`（2026-02-14）
- 最后核对：2026-02-21
- 稳定性：stable（查询）/ caution（写入）
- 权威来源：
  - <https://github.com/siyuan-community/siyuan-developer-docs/tree/main/docs/zh-Hans/reference/database>
  - <https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md>

## 1. `blocks` 内容块主表

|字段|含义|备注|
|---|---|---|
|`id`|块 ID|全局唯一|
|`parent_id`|父块 ID|文档块为空|
|`root_id`|文档根块 ID|文档层级聚合|
|`hash`|`content` 的 SHA256 校验和|校验用途|
|`box`|笔记本 ID|对应 Notebook|
|`path`|文档路径|`.sy` 路径|
|`hpath`|人类可读路径|用于 UI 展示|
|`name`|块名称|标题常用|
|`alias`|块别名|查询辅助|
|`memo`|块备注|注释信息|
|`tag`|标签|文档或块标签|
|`content`|纯文本内容|去掉 Markdown|
|`fcontent`|首子块纯文本|第一个子块文本|
|`markdown`|完整 Markdown|含标记|
|`length`|文本长度|基于 `fcontent`|
|`type`|块主类型|见块类型映射|
|`subtype`|块子类型|标题与列表|
|`ial`|内联属性列表|`{: name="value" }`|
|`sort`|排序权重|越小越靠前|
|`created`|创建时间|时间戳字符串|
|`updated`|更新时间|时间戳字符串|

## 2. `refs` 引用关系表

|字段|含义|备注|
|---|---|---|
|`id`|引用 ID|引用记录|
|`def_block_id`|被引用块 ID|定义端|
|`def_block_parent_id`|被引用块父 ID|定位上下文|
|`def_block_root_id`|被引用文档 ID|根块|
|`def_block_path`|被引用文档路径|`.sy`|
|`block_id`|引用所在块 ID|引用端|
|`root_id`|引用所在文档 ID|根块|
|`box`|引用所在笔记本|Notebook|
|`path`|引用所在文档路径|`.sy`|
|`content`|引用锚文本|展示用|
|`markdown`|引用 Markdown|包含引用标记|
|`type`|引用类型|如 `ref_id`|

## 3. `attributes` 属性表

|字段|含义|备注|
|---|---|---|
|`id`|属性 ID|记录标识|
|`name`|属性名|建议 `custom-*`|
|`value`|属性值|字符串|
|`type`|类型|类型字段|
|`block_id`|块 ID|所属块|
|`root_id`|文档 ID|根块|
|`box`|笔记本 ID|Notebook|
|`path`|文档路径|`.sy`|

## 4. `assets` 资源索引表

|字段|含义|备注|
|---|---|---|
|`id`|引用 ID|资产记录|
|`block_id`|块 ID|资源所在块|
|`root_id`|文档 ID|根块|
|`box`|笔记本 ID|Notebook|
|`docpath`|文档路径|`.sy`|
|`path`|资源路径|`assets/...`|
|`name`|文件名|资源文件名|
|`title`|资源标题|可选|
|`hash`|资源哈希|完整性|

## 5. `spans` 行内元素表

|字段|含义|备注|
|---|---|---|
|`id`|行内元素 ID|记录标识|
|`block_id`|块 ID|所属块|
|`root_id`|文档 ID|根块|
|`box`|笔记本 ID|Notebook|
|`path`|文档路径|`.sy`|
|`content`|元素内容|文本内容|
|`markdown`|元素 Markdown|含标记|
|`type`|元素类型|如 `tag`、`textmark`|
|`ial`|行内属性|样式或属性|

## 6. `file_annotation_refs` 注释引用表

|字段|含义|备注|
|---|---|---|
|`id`|引用 ID|注释记录|
|`file_path`|附件路径|PDF 等|
|`annotation_id`|注释 ID|目标注释|
|`block_id`|引用块 ID|引用端|
|`root_id`|文档 ID|根块|
|`box`|笔记本 ID|Notebook|
|`path`|文档路径|`.sy`|
|`content`|锚文本|展示用|
|`type`|注释类型|内部类型码|

## 7. `stat` 系统统计表

|key|value|说明|
|---|---|---|
|`siyuan_database_ver`|版本号|数据库版本|
|`{notebook_id}_hash`|哈希值|笔记本哈希|

## 8. 使用建议

- 插件中只读 SQL，写入统一走 `/api/*`。
- 需要完整字段时优先查本表，再对照官方文档。
- 字段含义可能随版本更新，升级后需重新核对。
