# 关键概念与数据架构速览

- 适用版本：SiYuan `v3.5.7`
- 官方仓库同步到：`siyuan-note/siyuan@master` + Release `v3.5.7`（2026-02-14）
- 最后核对：2026-02-21
- 稳定性：stable
- 权威来源：
  - <https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md>
  - <https://github.com/siyuan-note/siyuan/blob/master/kernel/api/router.go>
  - <https://github.com/siyuan-community/siyuan-developer-docs/tree/main/docs/zh-Hans/reference>

## 1. 数据对象关系（最小心智模型）

Notebook（Box）包含 Doc，Doc 由 Block 组成，Block 通过 Attr 与业务状态关联。AV（属性视图/数据库）是对 Block 的结构化视图与数据入口。

## 2. 核心表与作用

|表|用途|典型场景|
|---|---|---|
|`blocks`|所有内容块主表|按关键词、类型或路径检索内容|
|`refs`|引用与双链关系|块引用、反链统计|
|`attributes`|块属性键值|读取自定义属性与系统属性|
|`assets`|资源文件索引|资源定位、引用统计|
|`spans`|行内元素索引|标签、链接、行内标记检索|
|`file_annotation_refs`|PDF 注释引用|附件批注关联|
|`stat`|系统统计与版本|数据库版本与哈希|

## 3. ID 与路径字段

|字段|语义|开发关注点|
|---|---|---|
|`id`|块 ID|全局唯一，常用于 API 传参|
|`parent_id`|父块 ID|用于树形结构与层级定位|
|`root_id`|文档根块 ID|以文档为粒度的聚合与过滤|
|`box`|笔记本 ID|跨笔记本过滤与权限判断|
|`path`|文档路径|API 与 SQL 的路径过滤|
|`hpath`|人类可读路径|UI 展示与导航|
|`ial`|内联属性列表|解析 `{: name="value" }`|

## 4. AV（属性视图/数据库）关键概念

|术语|说明|常用 API|
|---|---|---|
|`avID`|属性视图 ID（数据库 ID）|`/api/av/*` 系列|
|`viewID`|视图 ID（表格/画廊等）|`renderAttributeView`|
|`rowID`|旧版行标识|逐步迁移到 `itemID`|
|`itemID`|新版行标识|与 `rowID` 并存期需兼容|
|`keyID`|列 ID|通过 `getAttributeViewKeysByAvID` 获取|
|`cellID`|单元格 ID|更新单元格时使用|
|绑定块|行与块绑定|便于基于块进行组织|
|非绑定块|行独立存在|适合纯结构化数据|

## 5. 接口与数据层对应关系

|需求|优先 API|数据库层|
|---|---|---|
|读写块内容|`/api/block/*`|`blocks`|
|读写块属性|`/api/attr/*`|`attributes`|
|数据库/属性视图|`/api/av/*`|`blocks` + AV 专用结构|
|文件读写|`/api/file/*`|工作空间文件系统|
|只读检索|`/api/query/sql`|只读 SQL 查询|

## 6. 常见注意事项

- 插件不要直接写数据库，写入请走官方 API。
- 自定义属性统一使用 `custom-` 前缀，避免与系统属性冲突。
- `rowID` 正在迁移到 `itemID`，新增功能需同时兼容。
- 视图结构随 `viewType` 变化，解析时不要写死字段结构。

## 7. 本章如何使用

- 先用本页建立术语统一，再读各专题文档。
- 需要字段细节时跳到 `reference/04-database-av/数据库表与字段详解.md`。
- 需要块类型或属性清单时跳到 `reference/05-block-model/块类型详表-Node与DB映射.md` 与 `reference/05-block-model/块属性清单与使用建议.md`。
