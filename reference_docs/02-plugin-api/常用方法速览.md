# 常用方法速览

- 适用版本：SiYuan `v3.5.7` / `petal v1.1.8`
- 最后核对：2026-02-21
- 稳定性：stable
- 权威来源：
  - <https://github.com/siyuan-note/petal/blob/main/siyuan.d.ts>

## 1. 网络与消息

### `fetchPost`

```ts
fetchPost(
  url: string,
  data?: any,
  cb?: (response: IWebSocketData) => void,
  headers?: IObject
): void
```

用途：异步调用内核接口，带成功/失败回调。

### `fetchSyncPost`

```ts
fetchSyncPost(url: string, data?: any): Promise<IWebSocketData>
```

用途：Promise 风格调用内核接口，插件里最常用。

### 请求处理建议

- 统一封装 `requestApi`，集中处理 `code/msg` 与日志。
- 对高频请求加节流或合并，避免阻塞 UI。

### `showMessage` / `hideMessage`

```ts
showMessage(text: string, timeout?: number, type?: "info" | "error", id?: string): void
hideMessage(id?: string): void
```

用途：短消息提示，适合操作反馈。

### `confirm`

```ts
confirm(title: string, text: string, confirmCallback?: (dialog: Dialog) => void, cancelCallback?: (dialog: Dialog) => void): void
```

用途：高风险操作前确认。

## 2. 页面与环境

### `openTab`

```ts
openTab(options: { app: App; doc?: {...}; custom?: {...}; position?: "right" | "bottom"; openNewTab?: boolean; ... }): ITab
```

用途：打开文档、资源、搜索或自定义页签。

### `getFrontend` / `getBackend`

```ts
getFrontend(): "desktop" | "desktop-window" | "mobile" | "browser-desktop" | "browser-mobile"
getBackend(): "windows" | "linux" | "darwin" | "docker" | "android" | "ios"
```

用途：按平台做功能降级。

### `adaptHotkey`

```ts
adaptHotkey(hotkey: string): string
```

用途：快捷键文本跨平台适配。

## 3. 示例：统一请求封装

```ts
import { fetchSyncPost, showMessage } from "siyuan";

export async function requestApi<T = any>(url: string, data?: any): Promise<T> {
  const res = await fetchSyncPost(url, data);
  if (res.code !== 0) {
    showMessage(`API error: ${res.msg || url}`, 5000, "error");
    throw new Error(res.msg || `Request failed: ${url}`);
  }
  return res.data as T;
}
```

## 4. 本章如何使用

- 开发时当作“签名速查表”
- 不确定参数时，以 `siyuan.d.ts` 为最终准则
- 高风险操作先接 `confirm`，异步请求优先 `fetchSyncPost`
