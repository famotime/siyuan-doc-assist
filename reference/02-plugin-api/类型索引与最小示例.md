# 类型索引与最小示例

- 适用版本：SiYuan `v3.5.7` / `petal v1.1.8`
- 最后核对：2026-02-21
- 稳定性：stable
- 权威来源：
  - <https://github.com/siyuan-note/petal/blob/main/siyuan.d.ts>

## 1. 高频类型

- 生命周期主类：`Plugin`
- 事件：`EventBus`、`TEventBus`、`IEventBusMap`
- 交互组件：`Dialog`、`Menu`、`Setting`
- 命令与停靠：`ICommand`、`IPluginDockTab`
- 网络响应：`IWebSocketData`

## 2. IWebSocketData 判定模板

```ts
interface IWebSocketData {
  code: number;
  msg: string;
  data: any;
}

function assertOk(res: IWebSocketData): asserts res is IWebSocketData & { code: 0 } {
  if (res.code !== 0) throw new Error(res.msg || "Unknown error");
}
```

## 3. ICommand 最小示例

```ts
this.addCommand({
  langKey: "run",
  hotkey: "Ctrl+Shift+R",
  callback: () => {
    console.log("run");
  },
});
```

注：`petal v1.1.8` 已放宽部分命令/工具栏 `hotkey` 约束，仍建议显式声明。

## 4. Dialog/Setting 组合示例

```ts
const setting = new Setting({ width: "520px" });
setting.addItem({
  title: "启用功能",
  description: "开启后会监听编辑器切换事件",
  createActionElement() {
    const el = document.createElement("input");
    el.type = "checkbox";
    return el;
  },
});
setting.open(this.name);
```

## 5. 本章如何使用

- 写功能前先确认所需类型，减少 `any`
- 出现签名冲突时，以 `siyuan.d.ts` 为最终准则
- 复杂类型只做“局部取用”，避免复制整份定义

